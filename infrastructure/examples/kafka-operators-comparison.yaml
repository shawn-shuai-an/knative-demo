# Kafka å®‰è£…æ–¹å¼å¯¹æ¯”ï¼šOperator vs Helm

# ==========================================
# æ–¹å¼1: Strimzi Kafka Operator (æ¨è)
# ==========================================

---
# 1.1 å®‰è£… Strimzi Operator
apiVersion: v1
kind: Namespace
metadata:
  name: kafka

---
# å®‰è£…å‘½ä»¤:
# kubectl create namespace kafka
# kubectl apply -f 'https://strimzi.io/install/latest?namespace=kafka' -n kafka

---
# 1.2 å£°æ˜å¼åˆ›å»º Kafka é›†ç¾¤ (è¶…ç®€å•!)
apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
  namespace: kafka
spec:
  kafka:
    version: 3.6.0
    replicas: 3
    listeners:
      - name: plain
        port: 9092
        type: internal
        tls: false
      - name: tls
        port: 9093
        type: internal
        tls: true
    config:
      offsets.topic.replication.factor: 3
      transaction.state.log.replication.factor: 3
      transaction.state.log.min.isr: 2
      default.replication.factor: 3
      min.insync.replicas: 2
    storage:
      type: persistent-claim
      size: 10Gi
      deleteClaim: false
  zookeeper:
    replicas: 3
    storage:
      type: persistent-claim
      size: 5Gi
      deleteClaim: false
  entityOperator:
    topicOperator: {}
    userOperator: {}

# Operator è‡ªåŠ¨åˆ›å»ºçš„èµ„æº:
# - StatefulSets (Kafka + Zookeeper)
# - Services (å†…éƒ¨å’Œå¤–éƒ¨è®¿é—®)
# - ConfigMaps (é…ç½®ç®¡ç†)
# - Secrets (è®¤è¯å’ŒTLS)
# - PersistentVolumeClaims (å­˜å‚¨)
# - NetworkPolicies (ç½‘ç»œå®‰å…¨)

---
# 1.3 åˆ›å»º Kafka Topic (å£°æ˜å¼)
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: knative-events
  namespace: kafka
  labels:
    strimzi.io/cluster: my-cluster
spec:
  partitions: 10
  replicas: 3
  config:
    retention.ms: 604800000  # 7 days
    segment.bytes: 1073741824  # 1GB

---
# 1.4 åˆ›å»º Kafka User (è‡ªåŠ¨è®¤è¯)
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaUser
metadata:
  name: knative-user
  namespace: kafka
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication:
    type: scram-sha-512
  authorization:
    type: simple
    acls:
    - resource:
        type: topic
        name: knative-events
      operations: ["Read", "Write"]

# ==========================================
# æ–¹å¼2: Helm Chart å®‰è£…
# ==========================================

---
# 2.1 Bitnami Kafka Helm Chart é…ç½®
# helm repo add bitnami https://charts.bitnami.com/bitnami
# helm install kafka bitnami/kafka -f values.yaml

# values.yaml å†…å®¹:
kafka-helm-values: |
  # é›†ç¾¤é…ç½®
  replicaCount: 3
  
  # æŒä¹…åŒ–å­˜å‚¨
  persistence:
    enabled: true
    size: 10Gi
    
  # è®¤è¯é…ç½®
  auth:
    clientProtocol: sasl
    sasl:
      mechanisms: scram-sha-256,scram-sha-512
      
  # èµ„æºé…ç½®
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
      
  # Zookeeper é…ç½®
  zookeeper:
    replicaCount: 3
    persistence:
      enabled: true
      size: 5Gi
      
  # ç›‘æ§é…ç½®
  metrics:
    kafka:
      enabled: true
    jmx:
      enabled: true

---
# 2.2 Confluent Helm Chart (ä¼ä¸šçº§)
# helm repo add confluentinc https://confluentinc.github.io/cp-helm-charts/
# helm install confluent confluentinc/cp-helm-charts

confluent-helm-values: |
  cp-kafka:
    brokers: 3
    persistence:
      enabled: true
      size: 10Gi
    configurationOverrides:
      "auto.create.topics.enable": false
      "default.replication.factor": 3
      
  cp-zookeeper:
    servers: 3
    persistence:
      enabled: true
      
  cp-schema-registry:
    enabled: true
    
  cp-kafka-rest:
    enabled: true
    
  cp-kafka-connect:
    enabled: true

# ==========================================
# æ–¹å¼å¯¹æ¯”è¡¨
# ==========================================

comparison-table: |
  
  | ç‰¹æ€§              | Strimzi Operator | Bitnami Helm     | Confluent Helm   | ä¼ ç»Ÿæ‰‹åŠ¨å®‰è£…    |
  |-------------------|------------------|------------------|------------------|-----------------|
  | **å®‰è£…éš¾åº¦**      | ğŸŸ¢ å¾ˆç®€å•         | ğŸŸ¡ ç®€å•           | ğŸŸ¡ ä¸­ç­‰           | ğŸ”´ å¤æ‚         |
  | **è¿ç»´è‡ªåŠ¨åŒ–**    | ğŸš€ å®Œå…¨è‡ªåŠ¨       | ğŸŸ¡ åŸºæœ¬è‡ªåŠ¨       | ğŸŸ¡ åŸºæœ¬è‡ªåŠ¨       | âŒ æ‰‹åŠ¨         |
  | **å‡çº§ç®¡ç†**      | ğŸš€ æ»šåŠ¨å‡çº§       | ğŸŸ¡ æ‰‹åŠ¨å‡çº§       | ğŸŸ¡ æ‰‹åŠ¨å‡çº§       | ğŸ”´ å¤æ‚å‡çº§     |
  | **é…ç½®ç®¡ç†**      | ğŸš€ å£°æ˜å¼         | ğŸŸ¡ Valuesæ–‡ä»¶     | ğŸŸ¡ Valuesæ–‡ä»¶     | ğŸ”´ å¤šæ–‡ä»¶ç®¡ç†   |
  | **æ•…éšœæ¢å¤**      | ğŸš€ è‡ªåŠ¨æ¢å¤       | ğŸŸ¡ åŠè‡ªåŠ¨         | ğŸŸ¡ åŠè‡ªåŠ¨         | ğŸ”´ æ‰‹åŠ¨æ¢å¤     |
  | **æ‰©ç¼©å®¹**        | ğŸš€ å£°æ˜å¼æ‰©ç¼©     | ğŸŸ¡ æ‰‹åŠ¨æ‰©ç¼©       | ğŸŸ¡ æ‰‹åŠ¨æ‰©ç¼©       | ğŸ”´ å¤æ‚æ‰©ç¼©     |
  | **ç›‘æ§é›†æˆ**      | âœ… å†…ç½®Prometheus | âœ… å¯é…ç½®         | âœ… ä¼ä¸šçº§ç›‘æ§     | ğŸ”´ éœ€è¦è‡ªå»º     |
  | **å®‰å…¨ç®¡ç†**      | ğŸš€ è‡ªåŠ¨TLS/è®¤è¯   | ğŸŸ¡ å¯é…ç½®         | ğŸŸ¡ å¯é…ç½®         | ğŸ”´ æ‰‹åŠ¨é…ç½®     |
  | **Topicç®¡ç†**     | ğŸš€ K8sèµ„æº       | ğŸŸ¡ å¤–éƒ¨å·¥å…·       | ğŸŸ¡ å¤–éƒ¨å·¥å…·       | ğŸ”´ å‘½ä»¤è¡Œ       |
  | **ç”¨æˆ·ç®¡ç†**      | ğŸš€ K8sèµ„æº       | ğŸŸ¡ å¤–éƒ¨é…ç½®       | ğŸŸ¡ å¤–éƒ¨é…ç½®       | ğŸ”´ æ‰‹åŠ¨é…ç½®     |
  | **å­¦ä¹ æˆæœ¬**      | ğŸŸ¡ ä¸­ç­‰           | ğŸŸ¢ ä½             | ğŸŸ¡ ä¸­ç­‰           | ğŸ”´ é«˜           |
  | **ç¤¾åŒºæ”¯æŒ**      | ğŸš€ æ´»è·ƒ           | ğŸš€ æ´»è·ƒ           | ğŸŸ¡ å•†ä¸šæ”¯æŒ       | ğŸŸ¡ å®˜æ–¹æ–‡æ¡£     |
  | **ä¼ä¸šç‰¹æ€§**      | ğŸŸ¡ åŸºç¡€ä¼ä¸šçº§     | ğŸŸ¡ åŸºç¡€ä¼ä¸šçº§     | ğŸš€ å®Œæ•´ä¼ä¸šçº§     | ğŸ”´ éœ€è¦è‡ªå»º     |

---
# æ¨èé€‰æ‹©çŸ©é˜µ:
#
# ğŸ¯ å¼€å‘æµ‹è¯•:     Bitnami Helm (å¿«é€Ÿä¸Šæ‰‹)
# ğŸ­ ç”Ÿäº§ç¯å¢ƒ:     Strimzi Operator (æœ€ä½³å®è·µ)  
# ğŸ¢ ä¼ä¸šç¯å¢ƒ:     Confluent Helm (å•†ä¸šæ”¯æŒ)
# ğŸ“ å­¦ä¹ ç ”ç©¶:     æ‰‹åŠ¨å®‰è£… (æ·±å…¥ç†è§£) 