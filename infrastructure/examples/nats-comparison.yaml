# NATS vs Kafka vs InMemory å¯¹æ¯”å’Œé…ç½®ç¤ºä¾‹

---
# 1. NATS é›†ç¾¤å®‰è£… (ä½¿ç”¨ NATS Operator)
apiVersion: v1
kind: Namespace
metadata:
  name: nats-system

---
# NATS é›†ç¾¤é…ç½®
apiVersion: nats.io/v1alpha2
kind: NatsCluster
metadata:
  name: nats-cluster
  namespace: nats-system
spec:
  size: 3
  version: "2.9.23"
  
  # æŒä¹…åŒ–é…ç½®
  pod:
    enableConfigReload: true
    reloader:
      image: natsio/nats-server-config-reloader:0.7.0
    natsContainer:
      image: nats:2.9.23-alpine
      
  # NATS JetStream (æŒä¹…åŒ–å­˜å‚¨)
  jetstream:
    enabled: true
    memStorage:
      enabled: true
      size: 1Gi
    fileStorage:
      enabled: true
      size: 10Gi
      storageClassName: standard

---
# 2. NatsChannel é…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: config-br-nats-channel
  namespace: knative-eventing
data:
  channel-template-spec: |
    apiVersion: messaging.knative.dev/v1alpha1
    kind: NatssChannel
    spec:
      # NATS è¿æ¥é…ç½®
      natssConfig:
        servers: "nats://nats-cluster:4222"
        # é›†ç¾¤æ¨¡å¼
        cluster:
          enabled: true
          replicas: 3
      # JetStream æŒä¹…åŒ–é…ç½®  
      jetstream:
        enabled: true
        stream:
          retention: "limits"
          maxAge: "7d"
          maxBytes: "1GB"
          replicas: 3

---
# 3. ä½¿ç”¨ NatsChannel çš„ Broker
apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
  name: nats-broker
  namespace: knative-demo
  annotations:
    eventing.knative.dev/broker.class: MTChannelBasedBroker
spec:
  config:
    apiVersion: v1
    kind: ConfigMap
    name: config-br-nats-channel
    namespace: knative-eventing
  delivery:
    retry: 3
    backoffPolicy: exponential
    backoffDelay: PT1S

---
# æ¶ˆæ¯ç³»ç»Ÿç‰¹æ€§å¯¹æ¯”è¡¨
# 
# | ç‰¹æ€§              | InMemoryChannel | NatsChannel      | KafkaChannel    |
# |-------------------|-----------------|------------------|-----------------|
# | **å®‰è£…å¤æ‚åº¦**    | ğŸŸ¢ æ— éœ€å®‰è£…      | ğŸŸ¡ ä¸­ç­‰          | ğŸ”´ å¤æ‚         |
# | **è¿ç»´å¤æ‚åº¦**    | ğŸŸ¢ é›¶ç»´æŠ¤        | ğŸŸ¡ è½»é‡ç»´æŠ¤      | ğŸ”´ é‡åº¦ç»´æŠ¤     |
# | **æŒä¹…åŒ–**        | âŒ æ—            | âœ… JetStream     | âœ… å®Œæ•´         |
# | **æ€§èƒ½**          | ğŸš€ æå¿«         | âš¡ å¿«            | âš¡ é«˜åå       |
# | **å†…å­˜å ç”¨**      | ğŸŸ¢ å¾ˆä½          | ğŸŸ¡ ä¸­ç­‰          | ğŸ”´ è¾ƒé«˜         |
# | **é›†ç¾¤æ”¯æŒ**      | âŒ å•èŠ‚ç‚¹        | âœ… ç®€å•é›†ç¾¤      | âœ… å®Œæ•´é›†ç¾¤     |
# | **äº‹ä»¶å›æ”¾**      | âŒ ä¸æ”¯æŒ        | âœ… æœ‰é™æ”¯æŒ      | âœ… å®Œæ•´æ”¯æŒ     |
# | **æ¶ˆæ¯é¡ºåº**      | âœ… å•çº¿ç¨‹æœ‰åº    | ğŸŸ¡ ä¸»é¢˜å†…æœ‰åº    | âœ… åˆ†åŒºå†…æœ‰åº   |
# | **äº‘åŸç”Ÿ**        | âœ… å®Œç¾          | âœ… å¾ˆå¥½          | ğŸŸ¡ éœ€è¦é…ç½®     |
# | **å­¦ä¹ æˆæœ¬**      | ğŸŸ¢ é›¶           | ğŸŸ¡ ä½            | ğŸ”´ é«˜           |
# | **ç¤¾åŒºç”Ÿæ€**      | â– N/A          | ğŸŸ¡ ä¸­ç­‰          | ğŸš€ ä¸°å¯Œ         |

---
# 4. NATS å®‰è£…è„šæœ¬ç¤ºä¾‹
# 
# # å®‰è£… NATS Operator
# kubectl apply -f https://github.com/nats-io/nats-operator/releases/latest/download/00-prereqs.yaml
# kubectl apply -f https://github.com/nats-io/nats-operator/releases/latest/download/10-deployment.yaml
# 
# # æˆ–è€…ä½¿ç”¨ Helm (æ¨è)
# helm repo add nats https://nats-io.github.io/k8s/helm/charts/
# helm install nats nats/nats
# 
# # éªŒè¯å®‰è£…
# kubectl get pods -n nats-system
# kubectl get natsclusters -A 