# ğŸ“Š Dapr ç›‘æ§å·¥å…·ä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. æœ€æ¨èï¼šä½¿ç”¨ Dapr å†…ç½®æŒ‡æ ‡ç›‘æ§
./scripts/dapr-metrics-monitor.sh

# 2. å¤‡é€‰ï¼šRedis Stream ç›´æ¥ç›‘æ§ (éœ€è¦ redis-cli)
./scripts/monitor-redis-streams.sh

# 3. Kubernetes å±‚é¢ç›‘æ§
./scripts/monitor-dapr-metrics.sh

# 4. ç®€å•çŠ¶æ€æ£€æŸ¥
./scripts/quick-monitor.sh
```

## ğŸ“ˆ ç›‘æ§å·¥å…·å¯¹æ¯”

| å·¥å…· | ä¼˜åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **dapr-metrics-monitor.sh** | âœ… æœ€å‡†ç¡®<br>âœ… Prometheus æ ‡å‡†<br>âœ… å»¶è¿Ÿåˆ†å¸ƒè¯¦ç»† | **é¦–é€‰**ï¼Œç”Ÿäº§ç¯å¢ƒç›‘æ§ |
| monitor-redis-streams.sh | âœ… åº•å±‚æ•°æ®<br>âœ… Consumer Group è¯¦æƒ… | æ·±åº¦æ’æŸ¥ï¼Œéœ€è¦ redis-cli |
| monitor-dapr-metrics.sh | âœ… K8s åŸç”Ÿ<br>âœ… æ—¥å¿—åˆ†æ | åº”ç”¨å±‚ç›‘æ§ |
| quick-monitor.sh | âœ… å¿«é€Ÿæ¦‚è§ˆ<br>âœ… å¤šç»´åº¦æ£€æŸ¥ | æ—¥å¸¸å·¡æ£€ |

## ğŸ“Š æ ¸å¿ƒç›‘æ§æŒ‡æ ‡

### ä»å®é™…è¿è¡Œç»“æœçœ‹åˆ°çš„æŒ‡æ ‡ï¼š

```
ğŸ“± Pod: dapr-simple-test-fixed
ğŸ“¤ å‘å¸ƒæŒ‡æ ‡: 53 æ¡æ¶ˆæ¯ï¼Œ100% â‰¤50ms
ğŸ“¥ æ¥æ”¶æŒ‡æ ‡: 182 æ¡æ¶ˆæ¯ï¼Œ100% â‰¤50ms  
âš–ï¸  æ¶ˆæ¯æµé‡: æ¶ˆè´¹é¢†å…ˆ +129 (å¥åº·çŠ¶æ€)
ğŸŒ HTTP è¯·æ±‚: 194 æ¬¡ï¼Œå…¨éƒ¨æˆåŠŸ
```

### å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼š

- **æ¶ˆæ¯å †ç§¯**: `æ¥æ”¶æ•° - å‘å¸ƒæ•°` 
  - `> 0`: âš ï¸ ç§¯å‹ï¼ˆç”Ÿäº§å¿«äºæ¶ˆè´¹ï¼‰
  - `< 0`: âœ… å¥åº·ï¼ˆæ¶ˆè´¹å¿«äºç”Ÿäº§ï¼‰
  
- **æ¶ˆè´¹é€Ÿåº¦**: `(å½“å‰æ¥æ”¶æ•° - ä¹‹å‰æ¥æ”¶æ•°) / æ—¶é—´å·®`

- **å»¶è¿Ÿåˆ†å¸ƒ**: 
  - â‰¤5ms: è¶…å¿«
  - â‰¤50ms: æ­£å¸¸  
  - >100ms: éœ€è¦å…³æ³¨

## ğŸ¯ ä½¿ç”¨å»ºè®®

### æ—¥å¸¸ç›‘æ§
```bash
# å¿«é€Ÿæ£€æŸ¥æ‰€æœ‰æŒ‡æ ‡
echo "4" | ./scripts/dapr-metrics-monitor.sh
```

### æ€§èƒ½æµ‹è¯•
```bash  
# 60ç§’åŸºå‡†æµ‹è¯•
echo "3" | ./scripts/dapr-metrics-monitor.sh
```

### å®æ—¶ç›‘æ§
```bash
# æŒç»­ç›‘æ§å…³é”®æŒ‡æ ‡
echo "2" | ./scripts/dapr-metrics-monitor.sh
```

### é—®é¢˜æ’æŸ¥
```bash
# è¯¦ç»†æŒ‡æ ‡åˆ†æ
echo "1" | ./scripts/dapr-metrics-monitor.sh

# ç»“åˆ Redis åº•å±‚åˆ†æ
./scripts/monitor-redis-streams.sh
```

## ğŸš¨ å‘Šè­¦å»ºè®®

åŸºäº Dapr æŒ‡æ ‡çš„å‘Šè­¦è§„åˆ™ï¼š

```bash
# æ¶ˆæ¯ç§¯å‹æ£€æŸ¥
if [ $((egress_count - ingress_count)) -gt 100 ]; then
    echo "âš ï¸ æ¶ˆæ¯ç§¯å‹è¶…è¿‡ 100 æ¡"
fi

# é«˜å»¶è¿Ÿæ£€æŸ¥  
if [ $(P95_latency) -gt 1000 ]; then
    echo "âš ï¸ P95 å»¶è¿Ÿè¶…è¿‡ 1 ç§’"
fi

# é”™è¯¯ç‡æ£€æŸ¥
if [ $(error_rate) -gt 0.01 ]; then
    echo "âš ï¸ é”™è¯¯ç‡è¶…è¿‡ 1%"
fi
```

## ğŸ“‹ æ•…éšœæ’æŸ¥æµç¨‹

1. **å¿«é€ŸçŠ¶æ€æ£€æŸ¥**
   ```bash
   ./scripts/quick-monitor.sh
   ```

2. **Dapr æŒ‡æ ‡åˆ†æ**  
   ```bash
   echo "1" | ./scripts/dapr-metrics-monitor.sh
   ```

3. **åº”ç”¨æ—¥å¿—æ£€æŸ¥**
   ```bash
   kubectl logs -n dapr-demo -l dapr.io/sidecar-injected=true -c app -f
   ```

4. **Redis åº•å±‚åˆ†æ**
   ```bash
   ./scripts/monitor-redis-streams.sh
   ```

5. **ç½‘ç»œè¿æ¥æ£€æŸ¥**
   ```bash
   echo "4" | ./scripts/monitor-dapr-metrics.sh
   ```

## ğŸ‰ æ€»ç»“

**Dapr æä¾›äº†ä¼ä¸šçº§çš„ç›‘æ§èƒ½åŠ›**ï¼š

âœ… **å‡†ç¡®æ€§**ï¼šç›´æ¥æ¥æºäº sidecar çš„ç²¾ç¡®æŒ‡æ ‡  
âœ… **æ ‡å‡†åŒ–**ï¼šPrometheus æ ¼å¼ï¼Œæ˜“äºé›†æˆ Grafana  
âœ… **å®Œæ•´æ€§**ï¼šè¦†ç›–å‘å¸ƒã€æ¥æ”¶ã€å»¶è¿Ÿã€é”™è¯¯ç­‰æ‰€æœ‰ç»´åº¦  
âœ… **å®æ—¶æ€§**ï¼šç§’çº§æ›´æ–°ï¼Œæ”¯æŒå®æ—¶å‘Šè­¦  

ä½¿ç”¨æˆ‘ä»¬çš„ç›‘æ§å·¥å…·ï¼Œæ‚¨å¯ä»¥ï¼š
- ğŸ“Š **å®æ—¶æŒæ¡**æ¶ˆæ¯æµé‡å’Œå †ç§¯æƒ…å†µ
- ğŸ” **ç²¾ç¡®åˆ†æ**å»¶è¿Ÿåˆ†å¸ƒå’Œæ€§èƒ½ç“¶é¢ˆ  
- ğŸš¨ **åŠæ—¶å‘ç°**å¼‚å¸¸å’Œæ•…éšœ
- ğŸ“ˆ **ä¼˜åŒ–æ€§èƒ½**åŸºäºæ•°æ®é©±åŠ¨çš„å†³ç­– 